{% extends "wagtailadmin/base.html" %}
{% load i18n static %}

{% block extra_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static "wagtail_calendar/fullcalendar/fullcalendar.min.css" %}" />
  <style>
    #planning-calendar {
      width: 80%;
      margin: auto;
    }
  </style>
{% endblock %}

{% block titletag %}{% trans 'Calendar' %}{% endblock %}

{% block content %}
  {% trans "Planning calendar" as title_trans %}
  {% include "wagtailadmin/shared/header.html" with title=title_trans %}

  <div id="planning-calendar"></div>
{% endblock %}

{% block extra_js %}
  {{ block.super }}
  <script src="{% static "wagtail_calendar/moment/moment.min.js" %}"></script>
  <script src="{% static "wagtail_calendar/fullcalendar/fullcalendar.min.js" %}"></script>
  <script src="{% static "wagtail_calendar/fullcalendar/locale-all.js" %}"></script>

  <script>
  {% get_current_language as LANGUAGE_CODE %}
  $(document).ready(function() {
      var locale = '{{ LANGUAGE_CODE }}'.substr(0, 2);
      $('#planning-calendar').fullCalendar({
          locale: locale,
          header: {
            left:   'title',
            center: 'month agendaWeek agendaDay',
            right:  'today prev,next'
          },
          events: '{% url 'wagtail_calendar:planning_calendar_events' %}',
          eventDrop: function(event, delta, revertFunc) {
              if (event.data.type === 'page' && event.data.pk !== undefined) {
                  if (!event.start.hasTime()) {
                      revertFunc();
                  } else {
                      var url = '{% url "wagtail_calendar:planning_calendar_plan_page" pk=0 %}'.replace(0, event.data.pk);
                      $.post(url, {
                          go_live_at: event.start.format().replace('T', ' '),  // Django default datetime validation...
                          csrfmiddlewaretoken: '{{ csrf_token }}'
                      });
                  }
              }
          }
      });
  });
  </script>
{% endblock %}